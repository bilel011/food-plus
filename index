<!DOCTYPE html>
<html>
<head>
    <title>Food Scanner Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1 { color: #2c3e50; }
        input, button { padding: 10px; margin: 5px; font-size: 16px; }
        .product { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; }
        img { max-width: 200px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ü•ó Food Scanner Demo</h1>
    <p>Entrez un code-barres pour tester :</p>
    
    <input type="text" id="barcode" placeholder="Ex: 3017620422003 (Nutella)">
    <button onclick="searchProduct()">üîç Chercher</button>
    
    <div id="result"></div>
    
    <script>
    async function searchProduct() {
        const code = document.getElementById('barcode').value;
        document.getElementById('result').innerHTML = '<p>üîç Recherche en cours...</p>';
        
        try {
            const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
            const data = await response.json();
            
            if (data.product) {
                const p = data.product;
                document.getElementById('result').innerHTML = `
                    <div class="product">
                        <h2>${p.product_name || 'Produit sans nom'}</h2>
                        ${p.image_url ? `<img src="${p.image_url}" alt="${p.product_name}">` : ''}
                        <p><strong>Marque:</strong> ${p.brands || 'Inconnue'}</p>
                        <p><strong>Nutri-Score:</strong> ${p.nutriscore_grade ? p.nutriscore_grade.toUpperCase() : 'Non not√©'}</p>
                        <p><strong>Cat√©gorie:</strong> ${p.categories || 'Non class√©'}</p>
                    </div>
                `;
            } else {
                document.getElementById('result').innerHTML = '<p>‚ùå Produit non trouv√©. Essayez un autre code.</p>';
            }
        } catch (error) {
            document.getElementById('result').innerHTML = '<p>‚ö†Ô∏è Erreur de connexion. V√©rifiez votre internet.</p>';
        }
    }
    
    // Remplissage automatique pour tester
    document.getElementById('barcode').addEventListener('click', function() {
        if (!this.value) {
            this.value = '3017620422003'; // Nutella par d√©faut
        }
    });
    </script>

    <!-- Ajoutez ce bouton -->
<button onclick="startCamera()">üì∑ Ouvrir la cam√©ra</button>

<!-- Et ce script -->
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
async function startCamera() {
    const codeReader = new ZXing.BrowserMultiFormatReader();
    
    try {
        const result = await codeReader.decodeFromVideoDevice(
            null, 
            'video', 
            (result) => {
                if (result) {
                    document.getElementById('barcode').value = result.text;
                    searchProduct();
                    codeReader.reset();
                }
            }
        );
    } catch (error) {
        alert("Cam√©ra non disponible: " + error.message);
    }
}
</script>
</body>
</html>
